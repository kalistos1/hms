{% extends 'pages_base.html' %}
{% load static %}
{% block title %}Room List{% endblock %}

{% block content %}
    <style>
        .background {
            width: 100%;
            height: 40vh;
            position: relative;
            background-color: #2C3E50;
            color: #ffffff;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url('{{ room_type.banner_img.url }}');
            background-size: cover;
            background-position: center;
            box-shadow: inset 0 0 0 1000px rgba(0, 0, 0, 0.5);
        }

        .background h2 {
            font-size: 3rem;
            font-weight: 700;
        }

        .background p {
            font-size: 1.2rem;
        }

        .card {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .utf_listing_payment_section h3 {
            font-weight: 600;
            margin-bottom: 20px;
        }

        .utf_listing_section ul {
            list-style: none;
            padding: 0;
        }

        .utf_listing_section li {
            background: #f7f7f7;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .utf_listing_section li h5 {
            margin: 0;
            font-size: 1.1rem;
        }

        .utf_listing_section li p {
            margin: 0;
            color: #777;
        }

        .utf_listing_section li span {
            font-weight: 600;
            color: #2980b9;
        }

        .utf_booking_listing_section_form input[type="text"],
        .utf_booking_listing_section_form input[type="date"],
        .utf_booking_listing_section_form select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .button {
            background-color: #2980b9;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
        }

        .button:hover {
            background-color: #3498db;
        }

        .utf_booking_listing_item_container {
            background-color: #2C3E50;
            color: #ffffff;
            padding: 20px;
            border-radius: 8px;
        }

        .utf_booking_listing_item_container h3 {
            font-weight: 700;
            margin-bottom: 10px;
        }

        .utf_star_rating_section {
            color: #f39c12;
        }

        .summary {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 20px;
            background: #f9f9f9;
        }

        .summary ul {
            list-style: none;
            padding: 0;
        }

        .summary li {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary li.total-costs {
            font-weight: 700;
            color: #e74c3c;
            font-size: 1.2rem;
        }
    </style>

    <div class="py-5 bg-gray background" style="background-image: url('{{ reservation.room.banner_img.url }} '); background-size: contain; background-position: center;" >
        <div class="overlay"></div>
        <div class="container">
            <div class="content text-center text-light">
                <h2 style="color:white;">{{reservation.room.room_type.type}} Room</h2>
                
            </div>
        </div>
    </div>

    <div class="container my-5 margin-bottom-75">
        <div class="row">
            <div class="col-lg-8 col-md-8 utf_listing_payment_section">
                <div class="notification warning closeable">
                    <p><span>NOTE!</span> Review your order before payment.</p>
                    <a class="close" href="#"></a>
                </div>
                <div class="utf_booking_listing_section_form margin-bottom-40">
                    <h3><i class="fas fa-bed"></i> Selected Rooms</h3>
                    <div class="utf_listing_section">
                        <div class="utf_pricing_list_section">
                            <ul>
                                {% if reservation %}
                                    <li>
                                        <h5>Room: {{reservation.room.room_type.type}}   {{reservation.room.room_number}}</h5>
                                        <p><strong>Beds :</strong> {{reservation.room.room_type.number_of_beds}}  </p>
                                        <span> &#8358 {{reservation.room.room_type.base_price}} </span>
                                    </li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="utf_booking_listing_section_form margin-bottom-40">
                    <h3><i class="fas fa-user"></i> Billing Information</h3>
                    <div class="row">
                        <div class="col-md-12">
                            <label>First Name</label>
                            <input name="full_name" type="text" value="{{reservation.user.get_full_name}}" readonly placeholder="First Name">
                        </div>
                        <div class="col-md-6">
                            <div class="medium-icons">
                                <label>E-Mail</label>
                                <input name="email" id="email" type="text" value="{{reservation.user.email}}" readonly placeholder="Email">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="medium-icons">
                                <label>Phone</label>
                                <input name="phone" type="text" value="{{reservation.user.phone}}" readonly >
                            </div>
                        </div>
                        <div class="col-lg-12">
                        </div>
                    </div>
                </div>


            </div>
            <div class="col-lg-4 col-md-4 margin-top-0 utf_listing_payment_section">
                <div class="utf_booking_listing_item_container compact utf_order_summary_widget_section">
                    <div class="listing-item">

                        <a href="{{ reservatiom.room.banner_img.url }}" class="room-img position-relative d-block" data-fancybox data-caption="Twin Room">
                            <img src="{{reservation.room.banner_img.url}}" alt class="img-fluid img-fluid-custome width_200 w-sm-100" width="320">
                        </a>
                        <div class="icon-content position-absolute d-flex">
                            <a class="zoom-icon mr-2" href="https://hotel.bdtask-demo.com/xainhotel/application/modules/room_setting/assets/images/2021-02-24/b1.jpg" data-fancybox data-caption="Twin Room"><i class="fas fa-search-plus"></i></a>
                        </div>



                        <div class="utf_listing_item_content">
                            <br>
                            
                            <h3 class="text-light">{{reservation.hotel}}</h3>
                           

                            <div class="utf_star_rating_section" data-rating="4.5">
                                <div class="utf_counter_star_rating">(18) Reviews</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="boxed-widget opening-hours summary margin-top-0">
                    <h3><i class="fa fa-calendar-check-o"></i> Booking Summary</h3>
                    <ul>
                        <li>Check-in <span>{{reservation.check_in_date}}</span></li>
                        <li>Check-out <span>{{reservation.check_out_date}}</span></li>
                        <li>Capacity <span>{{ reservation.num_adults }} Guests</span></li>                   

                        {% if reservation.coupon != 0.00 %}
                            <li>Discount<span>- &#8358 {{reservation.reservations}}</span></li>
                        {% endif %}

                        <li class="total-costs">
                            {% comment %} <form action="" method="POST">
                                {% csrf_token %}
                                <div class="col-md-8">
                                    <input id="couponCode" name="code" placeholder="Have a coupon enter here..." required="" type="text">
                                </div>
                                <div class="col-md-4">
                                    <input type="submit" class="coupon_code" value="Apply">
                                </div>
                            </form> {% endcomment %}
                            <div class="clearfix"></div>
                        </li>
                        {% for payment in reservation.payments.all %}
                        <li class="total-costs">Total Cost <span>  &#8358 {{payment.amount}}</span></li>
                        {% endfor %}
                    </ul>
                    <button id="pay_later" class="btn btn-dark utf_booking_confirmation_button margin-top-10 margin-bottom-10 w-100">
                        Pay Later
                    </button>
                    
                    <form method="POST" action="https://checkout.flutterwave.com/v3/hosted/pay">
                        <input type="hidden" name="public_key" value="FLWPUBK_TEST-a2c377d3cf56b37b9e660f85e26d2f8f-X" />
                        <input type="hidden" name="customer[email]" value="{{reservation.user.email}}" />
                        <input type="hidden" name="customer[name]" value="{{reservation.user.get_full_name}}" />
                        <input type="hidden" name="tx_ref" value="ID-{{reservation.reservation_id}}" />
                        {% for payment in reservation.payments.all %}
                        <input type="hidden" name="amount" value="{{payment.amount}}" />
                        {% endfor %}

                        <input type="hidden" name="currency" value="USD" />
                        <input type="hidden" name="meta[token]" value="54" />
                        <input type="hidden" name="redirect_url" value="{{website_address}}/success/{{reservation.reservation_id}}/?success_id={{reservation.success_id}}&reservation_total={% for payment in reservation.payments.all %} {{payment.amount}}  {% endfor %}" />

                        {% comment %} <button id="flutter-btn" class="button disable utf_booking_confirmation_button margin-top-20 w-100 " style="background-color: orange; color: rgb(37, 28, 3);">Pay with Flutterwave <img src="https://asset.brandfetch.io/iddYbQIdlK/idmlgmHt_3.png" style="width: 40px;" alt=""></button> {% endcomment %}
                        
                        <button id="flutter-btn" 
                                class="button disable utf_booking_confirmation_button margin-top-20 w-100" 
                                style="background-color: orange; color: rgb(37, 28, 3);" 
                                disabled>
                            Pay with Flutterwave 
                            <img src="https://asset.brandfetch.io/iddYbQIdlK/idmlgmHt_3.png" 
                                style="width: 40px;" 
                                alt="">
                        </button>
                    </form>
  
                    <button id="checkout-button" 
                            class="button utf_booking_confirmation_button margin-top-10 margin-bottom-10 w-100" 
                            disabled>
                        Pay with Stripe <i class="fas fa-credit-card"></i>
                    </button>
                    {% comment %} <button id="checkout-button" class="button  utf_booking_confirmation_button margin-top-10 margin-bottom-10 w-100">Pay with Stripe <i class="fas fa-credit-card"></i></button> {% endcomment %}
                    {% comment %} <div id="paypal-button-container"></div> {% endcomment %}
                </div>
            </div>
        </div>
    </div>
    </div>

    <script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <script type="text/javascript">



    // Create an instance of the Stripe object with your publishable API key
        var stripe = Stripe('{{ stripe_publishable_key }}');
        var checkoutButton = document.getElementById('checkout-button');

        checkoutButton.addEventListener('click', function () {

            var email = document.getElementById('email').value;
            if (email.length == 0) {
                alert("Please enter your email address.");
                return;
            }

            checkoutButton.innerHTML = "Starting..."

            fetch("{% url 'core:api_checkout_session' reservation_id=reservation.reservation_id %}", {
                method: 'POST',
                body: JSON.stringify(
                    { email: email }
                )
            }).then(function (response) {
                return response.json();
            })
                .then(function (session) {
                    return stripe.redirectToCheckout({ sessionId: session.sessionId });
                })
                .then(function (result) {
                    if (result.error) {
                        alert(result.error.message);
                    }
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        });
    </script>


    <script>
        reservation_id = "{{reservation.reservation_id}}"
        reservation_total = "{{reservation.total}}"
        success_id = "{{reservation.success_id}}"
        id = "{{reservation.id}}"

        paypal.Buttons({

            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: reservation_total
                        }
                    }]
                })
            },

            onApprove: function(data, actions) {
                return actions.order.capture().then(function(Details){
                    window.location.href = "/success/"+ reservation_id +"/?PayerID="+ id +"&success_id=" + success_id + "&reservation_total=" + reservation_total + "/" ;
                })
            }

        }).render('#paypal-button-container');
    </script>

    <script>
        let flutter_btn = document.getElementById("flutter-btn")
        flutter_btn.addEventListener("click", function(){
            flutter_btn.innerHTML = "Starting..."
        })
    </script>

    <script>
        document.getElementById('pay_later').addEventListener('click', function () {
            Swal.fire({
                title: 'Room Reserved!',
                text: 'The room has been reserved for 24 hours.',
                icon: 'success', // 'info', 'warning', 'error', or 'success'
                confirmButtonText: 'Go to Home Page',
                confirmButtonColor: '#3085d6',
                background: '#fffbe6',
                color: '#444',
                timer: 5000, // Auto-dismiss after 5 seconds (optional)
                backdrop: `rgba(0,0,123,0.4)` // Slightly transparent background
            }).then((result) => {
                // Redirect to the home page when the user clicks the button
                if (result.isConfirmed) {
                    window.location.href = '/'; // Replace '/' with your actual home page URL
                }
            });
        });
        
        
    </script>

{% endblock content %}

